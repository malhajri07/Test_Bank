{% extends 'base.html' %}
{% load i18n cms_tags %}

{% block title %}{% trans "Exam Stellar - Practice Tests for School, College & Professional" %}{% endblock %}

{% block content %}
<div class="max-w-9xl mx-auto px-4 sm:px-6 lg:px-8 w-full">
    <!-- CMS Homepage Announcements -->
    {% if cms_homepage_announcements %}
    <div class="pt-4">
        {% for announcement in cms_homepage_announcements %}
        {% render_announcement announcement %}
        {% endfor %}
    </div>
    {% endif %}

    <!-- Hero Section - Udemy Style with Image Support -->
    <section class="bg-white border-b border-gray-200">
        <div class="max-w-9xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
            {% if cms_hero_slides %}
            {% with slide=cms_hero_slides|first %}
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-center">
                <div class="max-w-2xl">
                    <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-4">
                        {{ slide.title }}
                    </h1>
                    {% if slide.description %}
                    <p class="text-lg text-gray-600 mb-6">
                        {{ slide.description }}
                    </p>
                    {% endif %}
                    {% if slide.primary_button_text and slide.primary_button_url %}
                    <a href="{{ slide.primary_button_url }}"
                        class="inline-block px-6 py-3 bg-[#5624d0] text-white font-semibold rounded hover:bg-[#4a1fb8] transition-colors">
                        {{ slide.primary_button_text }}
                    </a>
                    {% endif %}
                </div>
                {% if slide.background_image %}
                <div class="hidden lg:block">
                    <img src="{{ slide.background_image.url }}" alt="{{ slide.title }}"
                        class="w-full h-auto rounded-lg shadow-lg">
                </div>
                {% endif %}
            </div>
            {% endwith %}
            {% else %}
            <!-- Default hero - Udemy Style -->
            <div class="max-w-4xl">
                <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-4">
                    {% trans "Learn without limits" %}
                </h1>
                <p class="text-lg text-gray-600 mb-6">
                    {% trans "Master your exams with comprehensive practice tests" %}
                </p>
                <a href="{% url 'catalog:category_list' %}"
                    class="inline-block px-6 py-3 bg-[#5624d0] text-white font-semibold rounded hover:bg-[#4a1fb8] transition-colors">
                    {% trans "Browse Test Banks" %}
                </a>
            </div>
            {% endif %}
        </div>
    </section>

    <!-- User Intent Section -->
    {% include 'includes/user_intent.html' %}

    <!-- Partner/Institution Logos -->
    {% include 'includes/partners.html' %}

    <!-- Trending Test Banks Carousel - Udemy Style -->
    {% if trending_test_banks %}
    <section class="py-12 bg-white">
        <div class="max-w-9xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="mb-6">
                <h2 class="text-2xl font-bold text-gray-900">
                    {% trans "Trending test banks" %}
                </h2>
            </div>

            <div class="swiper trending-swiper relative group/swiper px-4 md:px-12">
                <div class="swiper-wrapper trending-swiper-wrapper">
                    {% for test_bank in trending_test_banks %}
                    <div class="swiper-slide w-80 h-[28rem] p-4">
                        <a href="{% url 'catalog:testbank_detail' slug=test_bank.slug %}" class="block h-full group">
                            <div
                                class="bg-white h-full rounded-2xl shadow-md hover:shadow-xl transition-all duration-500 hover:-translate-y-1 overflow-hidden flex flex-col">
                                <!-- Test Bank Image - Premium Style -->
                                {% if test_bank.image %}
                                <div class="h-52 bg-gray-50 relative overflow-hidden">
                                    <img src="{{ test_bank.image.url }}" alt="{{ test_bank.title }}"
                                        class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105">
                                    <div
                                        class="absolute inset-0 bg-black/0 group-hover:bg-black/5 transition-colors duration-500">
                                    </div>
                                    <!-- Difficulty Label -->
                                    <span class="absolute top-3 right-3 px-2.5 py-1 text-xs font-bold rounded-lg shadow-sm backdrop-blur-sm z-20
                                        {% if test_bank.difficulty_level == 'easy' %}bg-green-100/90 text-green-700 border border-green-200
                                        {% elif test_bank.difficulty_level == 'medium' %}bg-yellow-100/90 text-yellow-700 border border-yellow-200
                                        {% else %}bg-red-100/90 text-red-700 border border-red-200{% endif %}">
                                        {{ test_bank.get_difficulty_level_display }}
                                    </span>
                                </div>
                                {% else %}
                                <div
                                    class="h-52 bg-gray-100 relative overflow-hidden flex items-center justify-center group-hover:bg-gray-50 transition-colors duration-500">
                                    <svg class="w-12 h-12 text-gray-300" fill="none" stroke="currentColor"
                                        viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                                            d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                                    </svg>
                                    <!-- Difficulty Label -->
                                    <span class="absolute top-3 right-3 px-2.5 py-1 text-xs font-bold rounded-lg shadow-sm backdrop-blur-sm z-20
                                        {% if test_bank.difficulty_level == 'easy' %}bg-green-100/90 text-green-700 border border-green-200
                                        {% elif test_bank.difficulty_level == 'medium' %}bg-yellow-100/90 text-yellow-700 border border-yellow-200
                                        {% else %}bg-red-100/90 text-red-700 border border-red-200{% endif %}">
                                        {{ test_bank.get_difficulty_level_display }}
                                    </span>
                                </div>
                                {% endif %}

                                <div class="p-6 flex-1 flex flex-col">
                                    <h3
                                        class="text-lg font-semibold text-gray-900 mb-2 line-clamp-2 leading-snug tracking-tight group-hover:text-[#5624d0] transition-colors">
                                        {{ test_bank.title }}
                                    </h3>

                                    <!-- Rating - Premium Style -->
                                    <div class="flex items-center mb-4 min-h-[20px]">
                                        {% if user.is_authenticated and test_bank.has_access %}
                                        <!-- Interactive Rating for Subscribed Users -->
                                        <div class="flex items-center group/rating"
                                            data-testbank-slug="{{ test_bank.slug }}">
                                            {% with user_rating=test_bank.user_rating|default:0 %}
                                            {% for i in "12345" %}
                                            <button type="button"
                                                class="w-5 h-5 focus:outline-none transition-transform hover:scale-110"
                                                data-testbank-slug="{{ test_bank.slug }}"
                                                data-rating="{{ forloop.counter }}"
                                                onclick="rateTestBank(this.dataset.testbankSlug, parseInt(this.dataset.rating))">
                                                <svg class="w-full h-full {% if forloop.counter <= user_rating %}text-yellow-400 fill-current{% else %}text-gray-300 fill-current hover:text-yellow-400{% endif %}"
                                                    viewBox="0 0 20 20">
                                                    <path
                                                        d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                                                </svg>
                                            </button>
                                            {% endfor %}
                                            {% endwith %}
                                            <span
                                                class="text-xs text-gray-400 ml-2 opacity-0 group-hover/rating:opacity-100 transition-opacity">{%
                                                trans "Rate" %}</span>
                                        </div>
                                        {% else %}
                                        <!-- Read-only Average Rating -->
                                        {% if test_bank.average_rating > 0 %}
                                        <div class="flex items-center bg-yellow-50 px-2 py-1 rounded-md">
                                            <span class="text-sm font-bold text-yellow-700 mr-1.5">{{
                                                test_bank.average_rating|floatformat:1 }}</span>
                                            <svg class="w-3.5 h-3.5 text-yellow-500 fill-current" viewBox="0 0 20 20">
                                                <path
                                                    d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                                            </svg>
                                        </div>
                                        <span class="text-xs text-gray-400 font-medium ml-2">({{ test_bank.total_ratings
                                            }} reviews)</span>
                                        {% else %}
                                        <span
                                            class="text-xs text-gray-400 font-medium bg-gray-50 px-2 py-1 rounded-md">{%
                                            trans "New" %}</span>
                                        {% endif %}
                                        {% endif %}
                                    </div>

                                    <!-- User Count -->
                                    <div class="flex items-center text-xs text-gray-500 mb-4 font-medium">
                                        <svg class="w-4 h-4 mr-1.5 text-gray-400" fill="none" stroke="currentColor"
                                            viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
                                        </svg>
                                        {{ test_bank.get_user_count }} {% trans "students enrolled" %}
                                    </div>

                                    <!-- Price - Premium Style -->
                                    <div class="mt-auto pt-4 border-t border-gray-50 flex items-center justify-between">
                                        <span class="text-xl font-bold text-gray-900 tracking-tight">
                                            {% if test_bank.price == 0 %}
                                            {% trans "Free" %}
                                            {% else %}
                                            ${{ test_bank.price }}
                                            {% endif %}
                                        </span>
                                        <span
                                            class="text-xs font-semibold text-[#5624d0] bg-[#5624d0]/5 px-3 py-1.5 rounded-full group-hover:bg-[#5624d0] group-hover:text-white transition-all duration-300">{%
                                            trans "View Details" %}</span>
                                    </div>
                                </div>
                            </div>
                        </a>
                    </div>
                    {% endfor %}
                </div>
                <!-- Navigation Arrows -->
                <div
                    class="swiper-button-next trending-next !w-10 !h-10 !bg-white !rounded-full !shadow-lg !text-gray-800 !after:text-lg hover:!bg-gray-50 transition-all opacity-0 group-hover/swiper:opacity-100">
                </div>
                <div
                    class="swiper-button-prev trending-prev !w-10 !h-10 !bg-white !rounded-full !shadow-lg !text-gray-800 !after:text-lg hover:!bg-gray-50 transition-all opacity-0 group-hover/swiper:opacity-100">
                </div>
            </div>
        </div>
    </section>
    {% endif %}

    <!-- Explore Categories - Udemy Style -->
    {% if categories %}
    <section class="py-12 bg-white">
        <div class="max-w-9xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="mb-6">
                <h2 class="text-2xl font-bold text-gray-900">
                    {% trans "Explore categories" %}
                </h2>
            </div>

            <div class="swiper categories-swiper relative">
                <div class="swiper-wrapper categories-swiper-wrapper">
                    {% for category in categories %}
                    <div class="swiper-slide p-4">
                        <a href="{% if category.subcategory_count > 0 %}{% url 'catalog:category_detail' category_slug=category.slug %}{% else %}{% url 'catalog:testbank_list' category_slug=category.slug %}{% endif %}"
                            class="block h-full group">
                            <div
                                class="bg-white h-full rounded-2xl shadow-md hover:shadow-xl transition-all duration-500 hover:-translate-y-1 flex flex-col overflow-hidden">
                                <!-- Category Image - Premium Style -->
                                {% if category.image %}
                                <div class="h-44 bg-gray-50 relative overflow-hidden">
                                    <img src="{{ category.image.url }}" alt="{{ category.name }}"
                                        class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105">
                                    <div
                                        class="absolute inset-0 bg-black/0 group-hover:bg-black/5 transition-colors duration-500">
                                    </div>
                                </div>
                                {% else %}
                                <div
                                    class="h-44 bg-gradient-to-br from-blue-50 to-indigo-50 relative overflow-hidden flex items-center justify-center">
                                    <div class="text-blue-300 text-6xl font-bold opacity-50 select-none">{{
                                        category.name|first|upper }}</div>
                                </div>
                                {% endif %}
                                <div class="p-6 flex-1 flex flex-col">
                                    <h3
                                        class="text-xl font-semibold text-gray-900 mb-2 group-hover:text-[#5624d0] transition-colors tracking-tight">
                                        {{ category.name }}</h3>
                                    {% if category.description %}
                                    <p class="text-sm text-gray-500 mb-5 line-clamp-2 flex-1 leading-relaxed">{{
                                        category.description|truncatewords:12 }}</p>
                                    {% endif %}
                                    <div class="mt-auto pt-4 border-t border-gray-50 flex items-center justify-between">
                                        <span class="text-xs font-semibold text-gray-400 uppercase tracking-wider">
                                            {{ category.test_bank_count }} TEST BANKS
                                        </span>
                                        <div
                                            class="w-8 h-8 rounded-full bg-gray-50 flex items-center justify-center group-hover:bg-[#5624d0] group-hover:text-white transition-colors duration-300">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M9 5l7 7-7 7" />
                                            </svg>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </a>
                    </div>
                    {% endfor %}
                </div>
                <div class="swiper-button-next categories-next"></div>
                <div class="swiper-button-prev categories-prev"></div>
            </div>
        </div>
    </section>
    {% endif %}

    <!-- Most Popular by Category - Udemy Style -->
    {% if featured_test_banks %}
    <section class="py-12 bg-white">
        <div class="max-w-9xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="mb-6">
                <h2 class="text-2xl font-bold text-gray-900">
                    {% trans "Most popular by category" %}
                </h2>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                {% for test_bank in featured_test_banks %}
                <a href="{% url 'catalog:testbank_detail' slug=test_bank.slug %}" class="block h-full p-2 group">
                    <div
                        class="bg-white h-full rounded-2xl shadow-md hover:shadow-xl transition-all duration-500 hover:-translate-y-1 overflow-hidden flex flex-col">
                        <!-- Test Bank Image - Premium Style -->
                        {% if test_bank.image %}
                        <div class="h-52 bg-gray-50 relative overflow-hidden">
                            <img src="{{ test_bank.image.url }}" alt="{{ test_bank.title }}"
                                class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105">
                            <div
                                class="absolute inset-0 bg-black/0 group-hover:bg-black/5 transition-colors duration-500">
                            </div>
                                    <!-- Difficulty Label -->
                                    <span class="absolute top-3 right-3 px-2.5 py-1 text-xs font-bold rounded-lg shadow-sm backdrop-blur-sm z-20
                                        {% if test_bank.difficulty_level == 'easy' %}bg-green-100/90 text-green-700 border border-green-200
                                        {% elif test_bank.difficulty_level == 'medium' %}bg-yellow-100/90 text-yellow-700 border border-yellow-200
                                        {% else %}bg-red-100/90 text-red-700 border border-red-200{% endif %}">
                                        {{ test_bank.get_difficulty_level_display }}
                                    </span>
                        </div>
                        {% else %}
                        <div
                            class="h-52 bg-gradient-to-br from-emerald-50 to-teal-50 relative overflow-hidden flex items-center justify-center">
                            <div class="text-emerald-300 text-6xl font-bold opacity-50 select-none">{{
                                test_bank.title|first|upper }}</div>
                                    <!-- Difficulty Label -->
                                    <span class="absolute top-3 right-3 px-2.5 py-1 text-xs font-bold rounded-lg shadow-sm backdrop-blur-sm z-20
                                        {% if test_bank.difficulty_level == 'easy' %}bg-green-100/90 text-green-700 border border-green-200
                                        {% elif test_bank.difficulty_level == 'medium' %}bg-yellow-100/90 text-yellow-700 border border-yellow-200
                                        {% else %}bg-red-100/90 text-red-700 border border-red-200{% endif %}">
                                        {{ test_bank.get_difficulty_level_display }}
                                    </span>
                        </div>
                        {% endif %}

                        <div class="p-6 flex-1 flex flex-col">
                            <h3
                                class="text-lg font-semibold text-gray-900 mb-2 line-clamp-2 leading-snug tracking-tight group-hover:text-[#5624d0] transition-colors">
                                {{ test_bank.title }}
                            </h3>

                            <!-- Rating - Premium Style -->
                            <div class="flex items-center mb-4">
                                {% if test_bank.average_rating > 0 %}
                                <div class="flex items-center bg-yellow-50 px-2 py-1 rounded-md">
                                    <span class="text-sm font-bold text-yellow-700 mr-1.5">{{
                                        test_bank.average_rating|floatformat:1 }}</span>
                                    <svg class="w-3.5 h-3.5 text-yellow-500 fill-current" viewBox="0 0 20 20">
                                        <path
                                            d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                                    </svg>
                                </div>
                                <span class="text-xs text-gray-400 font-medium ml-2">({{ test_bank.total_ratings }}
                                    reviews)</span>
                                {% else %}
                                <span class="text-xs text-gray-400 font-medium bg-gray-50 px-2 py-1 rounded-md">{% trans
                                    "New" %}</span> {% endif %}
                            </div>

                            <!-- User Count -->
                            <div class="flex items-center text-xs text-gray-500 mb-4 font-medium">
                                <svg class="w-4 h-4 mr-1.5 text-gray-400" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
                                </svg>
                                {{ test_bank.get_user_count }} {% trans "students enrolled" %}
                            </div>

                            <!-- Price - Premium Style -->
                            <div class="mt-auto pt-4 border-t border-gray-50 flex items-center justify-between">
                                <span class="text-xl font-bold text-gray-900 tracking-tight">
                                    {% if test_bank.price == 0 %}
                                    {% trans "Free" %}
                                    {% else %}
                                    ${{ test_bank.price }}
                                    {% endif %}
                                </span>
                                <span
                                    class="text-xs font-semibold text-[#5624d0] bg-[#5624d0]/5 px-3 py-1.5 rounded-full group-hover:bg-[#5624d0] group-hover:text-white transition-all duration-300">{%
                                    trans "View Details" %}</span>
                            </div>
                        </div>
                    </div>
                </a>
                {% endfor %}
            </div>
        </div>
    </section>
    {% endif %}

    <!-- Testimonials Section -->
    {% include 'includes/testimonials.html' %}

    <!-- Final CTA Section - Udemy Style -->
    <section class="py-12 bg-white border-t border-gray-200">
        <div class="max-w-9xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <h2 class="text-2xl font-bold text-gray-900 mb-4">
                {% trans "Ready to get started?" %}
            </h2>
            <p class="text-lg text-gray-600 mb-6">
                {% trans "Join thousands of students using our platform to prepare for exams" %}
            </p>
            {% if not user.is_authenticated %}
            <a href="{% url 'accounts:register' %}"
                class="inline-block px-8 py-3 bg-[#5624d0] text-white font-semibold rounded hover:bg-[#4a1fb8] transition shadow-md">
                {% trans "Join for Free" %}
            </a>
            {% endif %}
        </div>
    </section>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Hero Carousel
            const heroSwiper = new Swiper('.hero-swiper', {
                slidesPerView: 1,
                spaceBetween: 0,
                loop: true,
                autoplay: {
                    delay: 5000,
                    disableOnInteraction: false,
                },
                pagination: {
                    el: '.swiper-pagination',
                    clickable: true,
                },
            });

            // Trending Test Banks Carousel
            const trendingSwiper = new Swiper('.trending-swiper', {
                slidesPerView: 'auto',
                spaceBetween: 16,
                loop: true,
                navigation: {
                    nextEl: '.trending-next',
                    prevEl: '.trending-prev',
                },
                breakpoints: {
                    640: {
                        slidesPerView: 'auto',
                        spaceBetween: 16,
                    },
                    768: {
                        slidesPerView: 'auto',
                        spaceBetween: 16,
                    },
                    1024: {
                        slidesPerView: 'auto',
                        spaceBetween: 16,
                    },
                },
            });

            // Categories Carousel
            const categoriesSwiper = new Swiper('.categories-swiper', {
                slidesPerView: 'auto',
                spaceBetween: 16,
                loop: true,
                navigation: {
                    nextEl: '.categories-next',
                    prevEl: '.categories-prev',
                },
                breakpoints: {
                    640: {
                        slidesPerView: 'auto',
                        spaceBetween: 16,
                    },
                    768: {
                        slidesPerView: 'auto',
                        spaceBetween: 16,
                    },
                    1024: {
                        slidesPerView: 'auto',
                        spaceBetween: 16,
                    },
                },
            });
        });
    </script>
</div>
{% endblock %}